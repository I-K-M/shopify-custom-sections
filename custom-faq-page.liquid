{%- if section.settings.divider -%}<div class="section--divider">{%- endif -%}

<div class="page-width page-width--narrow faq-design">
  {%- if section.settings.title != blank -%}
    <header class="section-header">
      <h2 class="section-header__title">
        {{ section.settings.title | escape }}
      </h2>
    </header>
  {%- endif -%}

  {%- if section.blocks.size > 0 -%}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {%- assign faq_items = section.blocks | where: "type", "question" -%}
          {%- for block in faq_items -%}
            {
              "@type": "Question",
              "name": {{ block.settings.title | json }},
              "acceptedAnswer": {
                "@type": "Answer",
                "text": {{ block.settings.text | json }}
              }
            }{%- unless forloop.last -%},{%- endunless -%}
          {%- endfor -%}
        ]
      }
    </script>

    <div class="faq-design__list">
      {%- for block in section.blocks -%}
        <div {{ block.shopify_attributes }}>
          {% case block.type %}
            {% when 'rich-text' %}
              <div class="index-section index-section--faq">
                <div class="text-{{ block.settings.align_text }}">
                  {%- if block.settings.title != blank -%}
                    <p class="h2">{{ block.settings.title | escape }}</p>
                  {%- endif -%}
                  {%- if block.settings.text != blank -%}
                    <div class="rte">
                      {{ block.settings.text }}
                    </div>
                  {%- endif -%}
                </div>
              </div>

            {% when 'question' %}
              {%- assign content_id = 'FAQ-content-' | append: block.id -%}

              <div class="faq-design__item">
                <button
                  type="button"
                  class="collapsible-trigger collapsible-trigger--inline collapsible--auto-height text-left faq-design__trigger"
                  aria-controls="{{ content_id }}"
                  aria-expanded="false"
                >
                  <span class="faq-design__q">{{ block.settings.title }}</span>
                  <span class="faq-design__icon" aria-hidden="true"></span>
                </button>

                <div id="{{ content_id }}" class="collapsible-content collapsible-content--all faq-design__content">
                  <div class="collapsible-content__inner collapsible-content__inner--faq rte faq-design__inner">
                    {{ block.settings.text }}
                  </div>
                </div>
              </div>
          {% endcase %}
        </div>
      {%- endfor -%}
    </div>
  {%- endif -%}

  {%- if section.blocks.size == 0 -%}
    <div class="placeholder-noblocks">
      {{ 'home_page.onboarding.no_content' | t }}
    </div>
  {%- endif -%}
</div>

{%- if section.settings.divider -%}</div>{%- endif -%}

<style>
  /* container */
  .faq-design { --faq-green:#1f5a2a; --faq-beige:#f3f1e8; }
  .faq-design__list { display: grid; gap: 12px; }

  /* item */
  .faq-design__item{
    border-radius: 18px;
    overflow: hidden;
    border: 1px solid rgba(0,0,0,.08);
    background: var(--faq-beige);
  }

  /* trigger */
  .faq-design__trigger{
    width:100%;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding: 16px 18px;
    font-weight: 600;
    background: transparent;
  }

  /* remove any theme pseudo icons */
  .faq-design__trigger .collapsible-icons,
  .faq-design__trigger svg { display:none !important; }

  /* icon circle */
  .faq-design__icon{
    width: 34px;
    height: 34px;
    border-radius: 999px;
    border: 2px solid var(--faq-green);
    position: relative;
    flex: 0 0 auto;
  }

  /* plus */
  .faq-design__icon::before,
  .faq-design__icon::after{
    content:"";
    position:absolute;
    inset:0;
    margin:auto;
    background: var(--faq-green);
    border-radius: 2px;
  }
  .faq-design__icon::before{ width:16px; height:2px; }
  .faq-design__icon::after{ width:2px; height:16px; }

  /* content spacing */
  .faq-design__content .faq-design__inner{ padding: 0 18px 18px; }

  /* OPEN state (Shopify collapsible toggles "is-open" on the trigger in many themes) */
  .faq-design__trigger.is-open{
    background: var(--faq-green);
    color:#fff;
  }
  .faq-design__trigger.is-open + .faq-design__content{
    background: var(--faq-green);
    color:#fff;
  }
  .faq-design__trigger.is-open + .faq-design__content .rte,
  .faq-design__trigger.is-open + .faq-design__content p,
  .faq-design__trigger.is-open + .faq-design__content a,
  .faq-design__trigger.is-open + .faq-design__content li{
    color:#fff;
  }

  .faq-design__trigger.is-open .faq-design__icon{ border-color:#fff; }
  .faq-design__trigger.is-open .faq-design__icon::before,
  .faq-design__trigger.is-open .faq-design__icon::after{ background:#fff; }

  /* plus -> X when open */
  .faq-design__trigger.is-open .faq-design__icon::before{
    transform: rotate(45deg);
    width:16px; height:2px;
  }
  .faq-design__trigger.is-open .faq-design__icon::after{
    transform: rotate(-45deg);
    width:16px; height:2px;
  }
</style>

<script>
  /* Keep aria-expanded in sync + support themes that don't set it */
  document.addEventListener('click', function(e){
    var btn = e.target.closest('.faq-design__trigger');
    if(!btn) return;

    // Let theme toggle classes first
    requestAnimationFrame(function(){
      var expanded = btn.classList.contains('is-open');
      btn.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    });
  });

  /* Optional: open first item by default (matches screenshot) */
  document.addEventListener('DOMContentLoaded', function(){
    var first = document.querySelector('.faq-design__trigger');
    if(first && !first.classList.contains('is-open')){
      first.click();
    }
  });
</script>

{% schema %}
{
  "name": "t:sections.faq.name",
  "class": "index-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.faq.settings.title.label",
      "default": "FAQs"
    }
  ],
  "blocks": [
    {
      "type": "rich-text",
      "name": "t:sections.faq.blocks.rich_text.name",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "t:sections.faq.blocks.rich_text.settings.title.label",
          "default": "Rich text"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "t:sections.faq.blocks.rich_text.settings.text.label",
          "default": "<p>Use this section for any descriptive text you need to fill out your pages or to add introductory headings between other blocks.</p>"
        },
        {
          "type": "select",
          "id": "align_text",
          "label": "t:sections.faq.blocks.rich_text.settings.align_text.label",
          "default": "left",
          "options": [
            { "value": "left", "label": "t:sections.faq.blocks.rich_text.settings.align_text.options.left.label" },
            { "value": "center", "label": "t:sections.faq.blocks.rich_text.settings.align_text.options.center.label" },
            { "value": "right", "label": "t:sections.faq.blocks.rich_text.settings.align_text.options.right.label" }
          ]
        }
      ]
    },
    {
      "type": "question",
      "name": "t:sections.faq.blocks.question.name",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "t:sections.faq.blocks.question.settings.title.label",
          "default": "Frequently asked question"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "t:sections.faq.blocks.question.settings.text.label",
          "default": "<p>Use this text to answer questions in as much detail as possible for your customers.</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.faq.presets.faq.name",
      "blocks": [
        { "type": "question" },
        { "type": "question" }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["footer", "header", "custom.popups"]
  }
}
{% endschema %}