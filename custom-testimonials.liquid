{%- style -%}
  .testimonials-{{ section.id }} {
    background-color: {{ section.settings.color_background }};
    color: {{ section.settings.color_text }};
    {%- if section.settings.background_image != blank -%}
      background-image: url({{ section.settings.background_image | image_url: width: 2400 }});
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
    {%- endif -%}
  }

  /* Card + avatar overlap */
  #Testimonials-{{ section.id }} .testimonials-slider__text {
    position: relative;
    background: #fff;
    border-radius: 14px;
    padding-top: 46px; /* space for floating avatar */
  }
  .testimonials-slide {
    padding-top:60px !important;
  }
  #Testimonials-{{ section.id }} .testimonial-avatar {
    position: absolute;
    top: -30px; /* 50% outside (60px avatar) */
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 60px;
    border-radius: 80px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    z-index: 2;
  }
  #Testimonials-{{ section.id }} .testimonial-avatar{
  position:absolute; /* already */
  overflow: visible; /* IMPORTANT so badge can stick out */
}

#Testimonials-{{ section.id }} .testimonial-avatar::after{
  content:"";
  position:absolute;
  right:-8px;   /* pushes it a bit outside */
  bottom:-8px;  /* pushes it a bit outside */
  width:26px;   /* adjust */
  height:26px;  /* adjust */
  background-image:url("https://cdn.shopify.com/s/files/1/0750/6201/8186/files/QUOTE.webp?v=1770126337");
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center;
  z-index:3;
  pointer-events:none;
}

  #Testimonials-{{ section.id }} .testimonial-avatar img,
  #Testimonials-{{ section.id }} .testimonial-avatar svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  /* Keep stars below avatar */
  #Testimonials-{{ section.id }} .testimonial-stars,
  #Testimonials-{{ section.id }} .quote-icon {
    display: inline-block;
    margin-top: 2px;
  }

  /* Move the middle/active slide up a bit */
  #Testimonials-{{ section.id }} .testimonials-slide.is-selected .testimonials-slider__text,
  #Testimonials-{{ section.id }} .testimonials-slide.slick-current .testimonials-slider__text,
  #Testimonials-{{ section.id }} .testimonials-slide.slick-active.slick-current .testimonials-slider__text {
    transform: translateY(-18px);
  }

  /* Footer small text centered under dots */
  .testimonials-{{ section.id }} .testimonials-footer {
    text-align: center;
    margin-top: 14px;
    font-size: 13px;
    opacity: 0.9;
  }
  .testimonials-{{ section.id }} .testimonials-footer p {
    margin: 0;
  }
{%- endstyle -%}

{%- if section.settings.divider -%}<div class="section--divider">{%- endif -%}

<div
  class="testimonials-section testimonials-{{ section.id }}{% if section.settings.color_background == settings.color_body_bg %} testimonials-section--with-divider{% endif %} text-{{ section.settings.align_text }}"
  data-section-id="{{ section.id }}"
  data-section-type="testimonials"
  data-aos>

  {%- if section.settings.pretitle != blank or section.settings.title != blank -%}
    <div class="page-width">
      <div class="section-header">

        {%- if section.settings.pretitle != blank -%}
          <div class="section-header__pretitle">
            {%- if section.settings.pretitle_icon != blank -%}
              <img
                class="section-header__pretitle-icon"
                src="{{ section.settings.pretitle_icon | image_url: width: 48 }}"
                alt=""
                loading="lazy"
                width="30"
                height="30">
            {%- endif -%}
            <span>{{ section.settings.pretitle }}</span>
          </div>
        {%- endif -%}

        {%- if section.settings.title != blank -%}
          <h2>{{ section.settings.title | escape }}</h2>
        {%- endif -%}

      </div>
    </div>
  {%- endif -%}

  {%- if section.blocks.size > 0 -%}
    <div class="slideshow-wrapper page-width">
      <div
        class="testimonials-slider"
        id="Testimonials-{{ section.id }}"
        data-dots="true"
        data-count="{{ section.blocks.size }}">

        {%- for block in section.blocks -%}
          <div
            class="testimonials-slide testimonials-slide--{{ block.id }}"
            data-index="{{ forloop.index0 }}"
            data-aos="row-of-{{ section.blocks.size }}"
            {{ block.shopify_attributes }}>

            <blockquote class="testimonials-slider__text">

              {%- if block.settings.image != blank -%}
                <div class="testimonial-avatar">
                  {%- liquid
                    assign sizeVariable = '60px'
                    assign fallback = sizeVariable
                  -%}
                  {%- render 'image-element',
                    img: block.settings.image,
                    sizeVariable: sizeVariable,
                    fallback: fallback,
                    widths: '120, 180, 240'
                  -%}
                </div>
              {%- endif -%}

              {%- if block.settings.icon == 'quote' -%}
                <span class="quote-icon">
                  <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-quote" viewBox="0 0 41 35">
                    <path d="M10.208 17.711h6.124v16.332H0V21.684C0 8.184 5.444.956 16.332 0v6.125c-4.083 1.14-6.124 4.414-6.124 9.82v1.766Zm24.498 0h6.124v16.332H24.498V21.684C24.498 8.184 29.942.956 40.83 0v6.125c-4.083 1.14-6.124 4.414-6.124 9.82v1.766Z" fill-rule="evenodd"/>
                  </svg>
                </span>
              {%- elsif block.settings.icon == '5-stars' -%}
                <span class="testimonial-stars">★★★★★</span>
              {%- elsif block.settings.icon == '4-stars' -%}
                <span class="testimonial-stars">★★★★</span>
              {%- elsif block.settings.icon == '3-stars' -%}
                <span class="testimonial-stars">★★★</span>
              {%- elsif block.settings.icon == '2-stars' -%}
                <span class="testimonial-stars">★★</span>
              {%- elsif block.settings.icon == '1-star' -%}
                <span class="testimonial-stars">★</span>
              {%- endif -%}

              {%- if block.settings.testimonial != blank -%}
                <div class="rte-setting text-spacing">{{ block.settings.testimonial }}</div>
              {%- endif -%}

              {%- if block.settings.author != blank -%}
                <cite>{{ block.settings.author | escape }}</cite>
              {%- endif -%}
              {%- if block.settings.author_info != blank -%}
                <div class="testimonials__info">{{ block.settings.author_info | escape }}</div>
              {%- endif -%}

            </blockquote>
          </div>
        {%- endfor -%}
      </div>

      {%- if section.settings.footer_text != blank -%}
        <div class="testimonials-footer page-width">
          {{ section.settings.footer_text }}
        </div>
      {%- endif -%}

    </div>
  {%- endif -%}
</div>

{%- if section.settings.divider -%}</div>{%- endif -%}

{% schema %}
{
  "name": "Custom Testimonials",
  "class": "index-section",
  "max_blocks": 9,
  "settings": [
    {
      "type": "text",
      "id": "pretitle",
      "label": "Pre-title",
      "default": "Pre-title"
    },
    {
      "type": "image_picker",
      "id": "pretitle_icon",
      "label": "Pre-title icon"
    },
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.testimonials.settings.title.label",
      "default": "Testimonials"
    },
    {
      "type": "image_picker",
      "id": "background_image",
      "label": "Background image"
    },
    {
      "type": "select",
      "id": "align_text",
      "label": "t:sections.testimonials.settings.align_text.label",
      "default": "center",
      "options": [
        { "value": "left", "label": "t:sections.testimonials.settings.align_text.options.left.label" },
        { "value": "center", "label": "t:sections.testimonials.settings.align_text.options.center.label" },
        { "value": "right", "label": "t:sections.testimonials.settings.align_text.options.right.label" }
      ]
    },
    {
      "type": "checkbox",
      "id": "round_images",
      "label": "t:sections.testimonials.settings.round_images.label",
      "info": "t:sections.testimonials.settings.round_images.info",
      "default": true
    },
    {
      "type": "color",
      "id": "color_background",
      "label": "t:sections.testimonials.settings.color_background.label",
      "default": "#f9f9f9"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "t:sections.testimonials.settings.color_text.label",
      "default": "#1c1d1d"
    },
    {
      "type": "richtext",
      "id": "footer_text",
      "label": "Footer text (under dots)",
      "default": "<p></p>"
    },
    {
      "type": "checkbox",
      "id": "divider",
      "label": "t:sections.testimonials.settings.divider.label",
      "default": false
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "t:sections.testimonials.blocks.testimonial.name",
      "settings": [
        {
          "type": "select",
          "id": "icon",
          "label": "t:sections.testimonials.blocks.testimonial.settings.icon.label",
          "default": "5-stars",
          "options": [
            { "value": "none", "label": "t:sections.testimonials.blocks.testimonial.settings.icon.options.none.label" },
            { "value": "quote", "label": "t:sections.testimonials.blocks.testimonial.settings.icon.options.quote.label" },
            { "value": "5-stars", "label": "t:sections.testimonials.blocks.testimonial.settings.icon.options.5-stars.label" },
            { "value": "4-stars", "label": "t:sections.testimonials.blocks.testimonial.settings.icon.options.4-stars.label" },
            { "value": "3-stars", "label": "t:sections.testimonials.blocks.testimonial.settings.icon.options.3-stars.label" },
            { "value": "2-stars", "label": "t:sections.testimonials.blocks.testimonial.settings.icon.options.2-stars.label" },
            { "value": "1-star", "label": "t:sections.testimonials.blocks.testimonial.settings.icon.options.1-star.label" }
          ]
        },
        {
          "type": "richtext",
          "id": "testimonial",
          "label": "t:sections.testimonials.blocks.testimonial.settings.testimonial.label",
          "default": "<p>Add customer reviews and testimonials to showcase your store’s happy customers.</p>"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:sections.testimonials.blocks.testimonial.settings.image.label"
        },
        {
          "type": "text",
          "id": "author",
          "label": "t:sections.testimonials.blocks.testimonial.settings.author.label",
          "default": "Author's name"
        },
        {
          "type": "text",
          "id": "author_info",
          "label": "t:sections.testimonials.blocks.testimonial.settings.author_info.label",
          "default": "Los Angeles, CA"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Testimonials",
      "blocks": [
        { "type": "testimonial" },
        { "type": "testimonial" },
        { "type": "testimonial" }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["footer", "header", "custom.popups"]
  }
}
{% endschema %}
